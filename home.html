<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Terminal Games</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
body { margin:0; padding:0; background:#000; color:#39FF14; font-family:'Press Start 2P', monospace; }
#terminal-container { width:90vw; max-width:900px; margin:20px auto; padding:10px; background:#111; border-radius:8px; display:flex; flex-direction:column; }
#terminal { flex:1; overflow-y:auto; height:60vh; }
.output-line { white-space:pre-wrap; }
.input-line { display:flex; align-items:center; margin-top:2px; }
.prompt { margin-right:6px; }
input { background:none; border:none; color:#39FF14; outline:none; font:inherit; flex:1; }
.dropdown { position:absolute; background:#111; border:1px solid #39FF14; display:none; flex-direction:column; z-index:10; }
.dropdown-item { padding:4px 8px; cursor:pointer; }
.dropdown-item.active { background:#39FF14; color:#000; }
.chess-board { display:inline-block; border:2px solid #444; margin:8px 0; }
.chess-row { display:flex; }
.chess-cell { width:32px; height:32px; text-align:center; line-height:32px; }
</style>
</head>
<body>
<div id="terminal-container">
  <div id="terminal"></div>
</div>
<script>
const COMMANDS=[{cmd:'/game', sub:['maze','minesweeper','chess']},{cmd:'about'}];
let history=[], historyIndex=-1;
const terminal=document.getElementById('terminal');

// Chess state
let chessGame=null;
const fileToCol={a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7};
const rankToRow={'1':7,'2':6,'3':5,'4':4,'5':3,'6':2,'7':1,'8':0};
const colToFile=['a','b','c','d','e','f','g','h'];
const rowToRank=['8','7','6','5','4','3','2','1'];

function createInputLine(){
    const line=document.createElement('div');
    line.className='input-line';
    const prompt=document.createElement('span');
    prompt.className='prompt';
    prompt.textContent='user@homebrew:~$';
    const input=document.createElement('input');
    input.type='text';
    line.appendChild(prompt);
    line.appendChild(input);
    terminal.appendChild(line);
    input.focus();

    input.addEventListener('keydown', e=>handleKeyDown(e,input));
}

function handleKeyDown(e,input){
    if(e.key==='Enter'){
        const cmd=input.value.trim();
        addPromptLine(cmd);
        if(cmd){ history.push(cmd); historyIndex=-1; processCommand(cmd); }
        input.disabled=true;
        createInputLine();
    } else if(e.key==='ArrowUp'){ if(history.length>0){ historyIndex=(historyIndex<=0)?history.length-1:historyIndex-1; input.value=history[historyIndex]; } e.preventDefault(); }
    else if(e.key==='ArrowDown'){ if(history.length>0){ historyIndex=(historyIndex>=history.length-1)?0:historyIndex+1; input.value=history[historyIndex]; } e.preventDefault(); }
}

function addPromptLine(cmd){ const div=document.createElement('div'); div.className='output-line'; div.innerHTML=`<span class="prompt">user@homebrew:~$</span> ${cmd}`; terminal.appendChild(div); terminal.scrollTop=terminal.scrollHeight; }
function addOutputLine(text){ const div=document.createElement('div'); div.className='output-line'; div.textContent=text; terminal.appendChild(div); terminal.scrollTop=terminal.scrollHeight; }

function processCommand(cmd){
    const tokens=cmd.split(' ');
    if(tokens[0]==='help'){ addOutputLine('Available commands: help, about, /game'); return; }
    if(tokens[0]==='about'){ addOutputLine('This is a homebrew terminal-style website with neon green text!'); return; }
    if(tokens[0]==='/game'){
        if(tokens.length<2){ addOutputLine('Usage: /game [maze|minesweeper|chess]'); return; }
        switch(tokens[1]){
            case 'maze': window.location.href='https://matip47.github.io/games/maze'; break;
            case 'minesweeper': addOutputLine('Minesweeper launched!'); break;
            case 'chess': launchChess(); break;
            default: addOutputLine('Unknown game'); return;
        }
        return;
    }
    if(chessGame && tokens.length===2){ moveChess(tokens[0],tokens[1]); return; }
    addOutputLine('Unknown command.');
}

// ===== Chess with simple AI =====
function launchChess(){
    chessGame={
        board:[
            ['♜','♞','♝','♛','♚','♝','♞','♜'],
            ['♟','♟','♟','♟','♟','♟','♟','♟'],
            [' ',' ',' ',' ',' ',' ',' ',' '],
            [' ',' ',' ',' ',' ',' ',' ',' '],
            [' ',' ',' ',' ',' ',' ',' ',' '],
            [' ',' ',' ',' ',' ',' ',' ',' '],
            ['♙','♙','♙','♙','♙','♙','♙','♙'],
            ['♖','♘','♗','♕','♔','♗','♘','♖']
        ],
        turn:'white'
    };
    renderChess();
    addOutputLine('Chess launched! Type moves like e2 e4');
}

function renderChess(){
    const div=document.createElement('div');
    div.className='chess-board';
    chessGame.board.forEach(row=>{
        const rowDiv=document.createElement('div');
        rowDiv.className='chess-row';
        row.forEach(cell=>{ const cellDiv=document.createElement('div'); cellDiv.className='chess-cell'; cellDiv.textContent=cell; rowDiv.appendChild(cellDiv); });
        div.appendChild(rowDiv);
    });
    terminal.appendChild(div); terminal.scrollTop=terminal.scrollHeight;
}

function moveChess(from,to){
    // Convert from/to to row/col
    const fr=rankToRow[from[1]], fc=fileToCol[from[0]];
    const tr=rankToRow[to[1]], tc=fileToCol[to[0]];
    const piece=chessGame.board[fr][fc];
    if(piece===' '){ addOutputLine('No piece at '+from); return; }
    const target=chessGame.board[tr][tc];
    // Basic move: cannot capture own piece
    if(piece.match(/[♙♖♘♗♕♔]/) && target.match(/[♙♖♘♗♕♔]/)) { addOutputLine('Invalid move'); return; }
    if(piece.match(/[♟♜♞♝♛♚]/) && target.match(/[♟♜♞♝♛♚]/)) { addOutputLine('Invalid move'); return; }
    // Make move
    chessGame.board[tr][tc]=piece;
    chessGame.board[fr][fc]=' ';
    renderChess();
    chessGame.turn = chessGame.turn==='white'?'black':'white';
    addOutputLine(`Moved ${from} to ${to}`);
    setTimeout(chessAI,300);
}

function chessAI(){
    if(!chessGame || chessGame.turn!=='black') return;
    // Very simple AI: random move
    const moves=[];
    for(let r=0;r<8;r++){
        for(let c=0;c<8;c++){
            const piece=chessGame.board[r][c];
            if(piece.match(/[♟♜♞♝♛♚]/)){
                const dr=[-1,0,1], dc=[-1,0,1];
                dr.forEach(dri=>{ dc.forEach(dci=>{ const nr=r+dri, nc=c+dci;
                    if(nr>=0&&nr<8&&nc>=0&&nc<8){ const target=chessGame.board[nr][nc]; if(!target.match(/[♟♜♞♝♛♚]/)){ moves.push({from:frcToAlg(r,c),to:frcToAlg(nr,nc)}); } } }); });
            }
        }
    }
    if(moves.length===0){ addOutputLine('Black has no legal moves'); return; }
    const move=moves[Math.floor(Math.random()*moves.length)];
    moveChess(move.from,move.to);
}

function frcToAlg(r,c){ return colToFile[c]+rowToRank[r]; }

createInputLine();
</script>
</body>
</html>
