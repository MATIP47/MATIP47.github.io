<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Terminal Games</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
body { margin:0; padding:0; background:#000; color:#39FF14; font-family:'Press Start 2P', monospace; }
#terminal-container { width:90vw; max-width:900px; margin:20px auto; padding:10px; background:#111; border-radius:8px; display:flex; flex-direction:column; }
#terminal { flex:1; overflow-y:auto; height:60vh; }
.output-line { white-space:pre-wrap; }
.prompt-line { display:flex; align-items:center; }
.prompt { margin-right:6px; }
#input-line { flex:1; background:none; border:none; color:#39FF14; outline:none; font:inherit; }
#autocomplete-dropdown { position:absolute; background:#111; border:1px solid #39FF14; display:none; flex-direction:column; z-index:10; }
#autocomplete-dropdown .item { padding:4px 8px; cursor:pointer; }
#autocomplete-dropdown .item.selected { background:#39FF14; color:#000; }
.minesweeper-board { display:inline-block; margin:8px 0; }
.minesweeper-row { display:flex; }
.minesweeper-cell { width:24px; height:24px; text-align:center; line-height:24px; border:1px solid #333; background:#232323; color:#fff; cursor:pointer; user-select:none; }
.minesweeper-cell.revealed { background:#282828; color:#7fd; cursor:default; }
.minesweeper-cell.mine { color:#f33; }
.chess-board { display:inline-block; border:2px solid #444; margin:8px 0; }
.chess-row { display:flex; }
.chess-cell { width:32px; height:32px; text-align:center; line-height:32px; }
</style>
</head>
<body>
<div id="terminal-container">
  <div id="terminal"></div>
  <div style="position:relative;">
    <div class="prompt-line">
      <span class="prompt">&gt;</span>
      <input id="input-line" autocomplete="off" autofocus spellcheck="false">
    </div>
    <div id="autocomplete-dropdown"></div>
  </div>
</div>
<script>
const COMMANDS=[{cmd:'/game', sub:['maze','minesweeper','chess']},{cmd:'about'}];
let history=[],historyIndex=-1,autocompleteItems=[],autocompleteIndex=0,autocompleteActive=false;
const terminal=document.getElementById('terminal');
const inputLine=document.getElementById('input-line');
const autocompleteDropdown=document.getElementById('autocomplete-dropdown');

function addOutputLine(html){const div=document.createElement('div');div.className='output-line';div.innerHTML=html;terminal.appendChild(div);terminal.scrollTop=terminal.scrollHeight;}
function addPromptLine(cmd){const div=document.createElement('div');div.className='output-line';div.innerHTML=`<span class="prompt">&gt;</span> ${cmd}`;terminal.appendChild(div);terminal.scrollTop=terminal.scrollHeight;}
function getAutocompleteOptions(prefix){const tokens=prefix.trim().split(/\s+/);if(tokens.length===1)return COMMANDS.map(c=>c.cmd).filter(cmd=>cmd.startsWith(tokens[0]));const cmdObj=COMMANDS.find(c=>c.cmd===tokens[0]);if(cmdObj&&cmdObj.sub&&tokens.length===2)return cmdObj.sub.filter(sub=>sub.startsWith(tokens[1]));return[];}
function showAutocomplete(prefix){autocompleteItems=getAutocompleteOptions(prefix);if(autocompleteItems.length===0){autocompleteDropdown.style.display='none';autocompleteActive=false;return;}autocompleteDropdown.innerHTML=autocompleteItems.map((item,idx)=>`<div class="item${idx===autocompleteIndex?' selected':''}">${item}</div>`).join('');const rect=inputLine.getBoundingClientRect();autocompleteDropdown.style.left=rect.left+'px';autocompleteDropdown.style.top=(rect.bottom+window.scrollY)+'px';autocompleteDropdown.style.display='flex';autocompleteActive=true;}
function hideAutocomplete(){autocompleteDropdown.style.display='none';autocompleteActive=false;}
function selectAutocomplete(selected){const tokens=inputLine.value.trim().split(/\s+/);inputLine.value=tokens.length===1?selected+' ':tokens[0]+' '+selected+' ';hideAutocomplete();inputLine.focus();}
autocompleteDropdown.addEventListener('mousedown',e=>{if(e.target.classList.contains('item')){selectAutocomplete(e.target.innerText);e.preventDefault();}});
inputLine.addEventListener('keydown',function(e){if(e.key==='ArrowUp'){if(history.length>0){if(historyIndex===-1)historyIndex=history.length;historyIndex=Math.max(0,historyIndex-1);inputLine.value=history[historyIndex];}hideAutocomplete();e.preventDefault();return;}if(e.key==='ArrowDown'){if(history.length>0&&historyIndex!==-1){historyIndex=Math.min(history.length-1,historyIndex+1);inputLine.value=history[historyIndex];}hideAutocomplete();e.preventDefault();return;}if(e.key==='Tab'){if(!autocompleteActive){showAutocomplete(inputLine.value);autocompleteIndex=0;}else{autocompleteIndex=(e.shiftKey?(autocompleteIndex-1+autocompleteItems.length)%autocompleteItems.length:(autocompleteIndex+1)%autocompleteItems.length);showAutocomplete(inputLine.value);}e.preventDefault();return;}if(e.key==='Escape'){hideAutocomplete();e.preventDefault();return;}if(e.key==='Enter'){if(autocompleteActive&&autocompleteItems.length>0){selectAutocomplete(autocompleteItems[autocompleteIndex]);e.preventDefault();return;}const cmd=inputLine.value.trim();if(cmd){addPromptLine(cmd);history.push(cmd);historyIndex=-1;inputLine.value='';hideAutocomplete();processCommand(cmd);}e.preventDefault();return;}}
);
inputLine.addEventListener('input',()=>hideAutocomplete());
document.addEventListener('click',e=>{if(!autocompleteDropdown.contains(e.target))hideAutocomplete();inputLine.focus();});

// ===== Command Processor =====
let minesweeper=null; let chessGame=null;
function processCommand(cmd){const tokens=cmd.trim().split(/\s+/);
if(tokens[0]==='/game'){
  if(tokens.length<2){addOutputLine('Usage: /game [maze|minesweeper|chess]');return;}
  switch(tokens[1]){
    case 'maze': addOutputLine('Redirecting to maze...'); setTimeout(()=>{window.location.href='https://matip47.github.io/games/maze';},300); break;
    case 'minesweeper': launchMinesweeper(); break;
    case 'chess': launchChess(); break;
    default: addOutputLine('Unknown game: '+tokens[1]); return;
  }
  return;
}
if(tokens[0]==='about'){addOutputLine('This is a homebrew terminal-style website with neon green text!'); return;}
if(chessGame && tokens.length===2){moveChess(tokens[0],tokens[1]); return;}
addOutputLine('Unknown command. Try /game [maze|minesweeper|chess] or about');}

// ===== Minesweeper =====
function launchMinesweeper(){const rows=5,cols=5,mines=5;minesweeper={board:Array.from({length:rows},()=>Array(cols).fill(0)),revealed:Array.from({length:rows},()=>Array(cols).fill(false))};let placed=0;while(placed<mines){let r=Math.floor(Math.random()*rows),c=Math.floor(Math.random()*cols);if(minesweeper.board[r][c]!==9){minesweeper.board[r][c]=9;placed++;}}for(let r=0;r<rows;r++){for(let c=0;c<cols;c++){if(minesweeper.board[r][c]===9)continue;let cnt=0;for(let dr=-1;dr<=1;dr++){for(let dc=-1;dc<=1;dc++){let nr=r+dr,nc=c+dc;if(nr>=0&&nr<rows&&nc>=0&&nc<cols&&minesweeper.board[nr][nc]===9)cnt++;}}minesweeper.board[r][c]=cnt;}}displayMinesweeper();}
function displayMinesweeper(){const div=document.createElement('div');div.className='minesweeper-board';minesweeper.board.forEach((row,r)=>{const rowDiv=document.createElement('div');rowDiv.className='minesweeper-row';row.forEach((cell,c)=>{const cellDiv=document.createElement('div');cellDiv.className='minesweeper-cell';cellDiv.textContent=minesweeper.revealed[r][c]?(cell===9?'üí£':cell===0?' ':' '+cell):'‚ñ°';cellDiv.addEventListener('click',()=>{revealCell(r,c);});rowDiv.appendChild(cellDiv);});div.appendChild(rowDiv);});terminal.insertBefore(div,document.getElementById('currentLine'));terminal.scrollTop=terminal.scrollHeight;}
function revealCell(r,c){if(!minesweeper||r<0||r>=minesweeper.board.length||c<0||c>=minesweeper.board[0].length||minesweeper.revealed[r][c])return;minesweeper.revealed[r][c]=true;if(minesweeper.board[r][c]===0){for(let dr=-1;dr<=1;dr++){for(let dc=-1;dc<=1;dc++){if(dr!==0||dc!==0)revealCell(r+dr,c+dc);}}}displayMinesweeper();}

// ===== Chess with AI, check/checkmate/stalemate =====
const fileToCol={a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7};
const rankToRow={'1':7,'2':6,'3':5,'4':4,'5':3,'6':2,'7':1,'8':0};
const rowToRank=['8','7','6','5','4','3','2','1'];
const colToFile=['a','b','c','d','e','f','g','h'];
function launchChess(){chessGame={board:[['‚ôú','‚ôû','‚ôù','‚ôõ','‚ôö','‚ôù','‚ôû','‚ôú'],['‚ôü','‚ôü','‚ôü','‚ôü','‚ôü','‚ôü','‚ôü','‚ôü'],[' ',' ',' ',' ',' ',' ',' ',' '],[' ',' ',' ',' ',' ',' ',' ',' '],[' ',' ',' ',' ',' ',' ',' ',' '],[' ',' ',' ',' ',' ',' ',' ',' '],['‚ôô','‚ôô','‚ôô','‚ôô','‚ôô','‚ôô','‚ôô','‚ôô'],['‚ôñ','‚ôò','‚ôó','‚ôï','‚ôî','‚ôó','‚ôò','‚ôñ']],turn:'white'};renderChess();}
function renderChess(){const div=document.createElement('div');div.className='chess-board';chessGame.board.forEach((row,r)=>{const rowDiv=document.createElement('div');rowDiv.className='chess-row';row.forEach((cell,c)=>{const cellDiv=document.createElement('div');cellDiv.className='chess-cell';cellDiv.textContent=cell;rowDiv.appendChild(cellDiv);});div.appendChild(rowDiv);});terminal.insertBefore(div,document.getElementById('currentLine'));terminal.scrollTop=terminal.scrollHeight;}
function isSameColor(p1,p2){if(p1===' '||p2===' ')return false;return(/[‚ôô‚ôñ‚ôò‚ôó‚ôï‚ôî]/.test(p1)&&/[‚ôô‚ôñ‚ôò‚ôó‚ôï‚ôî]/.test(p2))||(/[‚ôü‚ôú‚ôû‚ôù‚ôõ‚ôö]/.test(p1)&&/[‚ôü‚ôú‚ôû‚ôù‚ôõ‚ôö]/.test(p2));}
function rcToAlgebraic(r,c){return colToFile[c]+rowToRank[r];}
function isInCheck(color){const king=color==='white'?'‚ôî':'‚ôö';let kingPos=null;for(let r=0;r<8;r++){for(let c=0;c<8;c++){if(chessGame.board[r][c]===king)kingPos={r,c};}}if(!kingPos)return true;const opponentColor=color==='white'?'black':'white';const moves=getAllLegalMoves(opponentColor,true);return moves.some(m=>{const tr=rankToRow[m.to[1]],tc=fileToCol[m.to[0]];return tr
